<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">

  <title>The DomRep Rummy Cup - Laptop</title>
  <meta name="description" content="Laptop Ansicht">
  <meta name="author" content="SAKM">

  <link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.css">
  <link rel="stylesheet" href="./node_modules/font-awesome/css/font-awesome.css">
  <link rel="stylesheet" href="styles.css">

  <script src="./node_modules/jquery/dist/jquery.js"></script>
  <script src="./node_modules/tether/dist/js/tether.js"></script>
  <script src="./node_modules/bootstrap/dist/js/bootstrap.js"></script>
  <script src="./node_modules/vue/dist/vue.js"></script>
  <script src="./node_modules/vue-resource/dist/vue-resource.js"></script>
  <script src="./node_modules/socket.io-client/dist/socket.io.js"></script>  

</head>
    

<body>
    <div id="app" class="container">

        <h2 style="text-align: center;">
                <img src="cartoon-palms.jpg" width="100px"/>
                DomRep RummyCup</h2>

        <div class="row">
            <div v-for="(currentCard, colIndex) in currentCards">
                <div v-bind:class="['card', 'currentCard', currentCard.color, (selectedCard != null && selectedCard.id == currentCard.id)? 'active' : '']"
                    v-on:click="selectCard(currentCard)">
                    <div class="card-block" >
                            <p class="cardText">{{ currentCard.value }}</p>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary m-1" v-on:click="giveCardToPlayer(0)">
                    Martin
            </button>
            
            <button class="btn btn-primary m-1" v-on:click="giveCardToPlayer(1)">
                    Karin
            </button>

            <button class="btn btn-primary m-1" v-on:click="giveCardToPlayer(2)">
                    Alicia
            </button>

            <button class="btn btn-primary m-1" v-on:click="giveCardToPlayer(3)">
                    Simon
            </button>

        </div>

        <div class="row d-flex justify-content-center align-items-stretch flex-wrap" v-for="(row, rowIndex) in board.rows">
            <div v-bind:class="[ 'card', 'cardSmall', card.card.color, 'm-1' ]" v-bind:id="card.id" 
                v-on:click="putCard(rowIndex, colIndex)"
                v-for="(card, colIndex) in row">
                <!--<div class="card-block" >-->
                        <p class="smallCardText">{{ card.card != null ? card.card.value : '' }}</p>
               <!-- </div>-->
            </div>
        </div>
    </div>

    <script>
        var app = new Vue({
            el: '#app',
            methods: {
                refreshMessage(resource) {
                    this.$http.get(this.baseUrl +'board').then((response) => {
                        this.board = response.body.board;
                    });

                    this.$http.get(this.baseUrl +'currentCards').then((response) => {
                        this.currentCards = response.body;
                    });
                },

                putCard(row, col) {
                    var oldCard = JSON.parse(JSON.stringify(this.board.rows[row][col].card));

                    // tausche Karte vom Board mit CurrentCard
                    this.$http.post(this.baseUrl +'putCard', {row: row, col: col,
                         card: this.selectedCard})
                    .then((response) => {
                        this.$http.post(this.baseUrl +'currentCard', oldCard);
                        this.selectCard(null);
                    });
                },

                giveCardToPlayer(playerId) {
                    if (this.selectedCard != null) {
                        this.$http.get(this.baseUrl +'giveCardToPlayer?playerId=' + playerId 
                            + "&cardId=" + this.selectedCard.id);
                    }
                },

                selectCard(card) {
                    this.selectedCard = card;
                }
            },
            data: {
                board: {},
                currentCards: [],
                baseUrl: '/',
                socket: {},
                selectedCard: null
            },
            created: function () {
                try {
                    var that = this;
                    this.socket = io();

                    this.socket.on('refresh', function(msg) {
                        console.log('refresh');
                        that.refreshMessage();
                    });
                }
                catch (e) {
                    console.log(e);
                }
            }
        })
    </script>
</body>
</html>